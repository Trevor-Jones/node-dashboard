<!DOCTYPE html>
<html>
	<head>
		<script src="table.js"></script>
		<script src="jquery-2.2.3.js"></script>
		<link href="c3.css" rel="stylesheet" type="text/css">
		<script src="d3.min.js" charset="utf-8"></script>
		<script src="c3.min.js"></script>
		<script src="interact.min.js"></script>
        <script src="socket.io.js"></script>
        <script src="graph.js"></script>
		<title>JSON Table</title>
		<link rel="stylesheet" href="styles.css">
	</head>
	<p>
		<div id="chart" class="draggable"></div>
        <script>
            var i;
            var myJson;
            var properties;
            var receivedJson;
            var jsonObj = JSON.parse('{}');
            var initialized = false;
            
            var socket = io.connect('http://localhost:3002');
            socket.on('json', function (data) {
             
                socket.emit('request', 'received');
                
                properties = [];
                receivedJson = JSON.parse(data);
                if(!initialized) {
                    for (var prop in receivedJson) {
                        if(receivedJson.hasOwnProperty(prop)) {
                            properties.push(prop);
                            jsonObj[prop] = [];
                        }
                    }
                    initialized = true;
                }
                
                for (i = 0; i < properties.length; i++) {
                    receivedJson[properties[i]] = parseFloat(receivedJson[properties[i]]);
                    jsonObj[properties[i]].push(receivedJson[properties[i]]);
                }
            });
            
//            alert(JSON.stringify(jsonObj));
            
			var chart = c3.generate({
                bindto: '#chart',
				data: {
                    json: jsonObj
				}
			});

			setInterval(function () {
				chart.load({
                    json: jsonObj
				});
//                alert(JSON.stringify(jsonObj));
			}, 1000);
		</script>

		<script>
			interact('.draggable').draggable({
                inertia: false,         
                restrict: {             
                    endOnly: true,
                    elementRect: { top: 0, left: 0, bottom: 1, right: 1 }
                },
                autoScroll: true,     
                onmove: dragMoveListener,   
            });
		</script>
	</p>
</html>