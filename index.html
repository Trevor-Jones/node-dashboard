<!DOCTYPE html>
<html>
	<head>
        <script src="socket.io.js"></script>
        <script type="text/javascript" src="smoothie.js"></script>
		<title>JSON Table</title>
		<link rel="stylesheet" href="styles.css">
	</head>
	<p>
        <canvas id="mycanvas" width="1000" height="200"></canvas>
            
        <script>
            var receivedJson;
            var properties = [];
            var initialized = false;
            var jsonObj = {};
            
            var smoothie = new SmoothieChart();
            smoothie.streamTo(document.getElementById("mycanvas"), 1000);

            // Data
            var line1 = new TimeSeries();
            var line2 = new TimeSeries();

            var socket = io.connect('http://localhost:3002');
            socket.on('json', function (data) {
                receivedJson = JSON.parse(data);

                if(!initialized) {
                    var loopCounter = 0;
                    for(var prop in receivedJson) {
                        var id = "chart".concat(loopCounter); 
                        properties.push([]);
                        jsonObj[prop] = {};
                        for (var variables in receivedJson[prop]) {
                            if(receivedJson[prop].hasOwnProperty(variables)) {
                                properties[loopCounter].push(variables);
                                jsonObj[prop][variables] = [];
                            }
                        }
                        loopCounter++;
                    }
                    initialized = true;
                }

                var iterator = 0;
                for(var prop in receivedJson) {
                    for (var u = 0; u < properties[iterator].length; u++) {
                        receivedJson[prop][properties[iterator][u]] = parseFloat(receivedJson[prop][properties[iterator][u]]);
                    } 
                    iterator++;
                }

                line1.append(new Date().getTime(), receivedJson['chart0']['velocity']);
                line2.append(new Date().getTime(), 0.5);

                // Add to SmoothieChart
                smoothie.addTimeSeries(line1);
                smoothie.addTimeSeries(line2);

                socket.emit('request', 'received');
            });
		</script>
	</p>
</html>